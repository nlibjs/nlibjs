language: node_js
cache: npm
os:
- linux
- osx
- windows
node_js:
- '10'
before_install:
- |
  if [[ $TRAVIS_OS_NAME == windows ]]; then
    git config --global core.autocrlf false
    cd ../..
    mv $TRAVIS_REPO_SLUG _old
    git clone _old $TRAVIS_REPO_SLUG
    cd $TRAVIS_REPO_SLUG
  fi
install:
- npm install -g c8
- npm ci
script:
- npm run build
- c8 npx lerna run test --parallel
- |
  if [[ $TRAVIS_OS_NAME == linux ]]; then
    npm run check-dependencies
    git diff --exit-code
    npm install -g @commitlint/travis-cli
    commitlint-travis
  fi
after_success:
- c8 report --reporter lcov
- npm install -g codecov
- codecov
